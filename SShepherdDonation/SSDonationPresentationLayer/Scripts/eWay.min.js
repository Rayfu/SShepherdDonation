var eWAYUtils, fieldEvent, secureField, eWAY; (function (n, t) { function r() { if (!u) { u = !0; for (var n = 0; n < i.length; n++) i[n].fn.call(window, i[n].ctx); i = [] } } function e() { document.readyState === "complete" && r() } n = n || "docReady"; t = t || window; var i = [], u = !1, f = !1; t[n] = function (n, t) { if (u) { setTimeout(function () { n(t) }, 1); return } i.push({ fn: n, ctx: t }); document.readyState === "complete" ? setTimeout(r, 1) : f || (document.addEventListener ? (document.addEventListener("DOMContentLoaded", r, !1), window.addEventListener("load", r, !1)) : (document.attachEvent("onreadystatechange", e), window.attachEvent("onload", r)), f = !0) } })("docReady", window), function (n) { function u() { var n = window; n.ewayVars || (n.ewayVars = { eWAYVars: !0 }) } function t(n) { u(); var t = window; return t.ewayVars[n] } function i(n, t) { u(); var i = window; i.ewayVars[n] = t; return } function e(n, t) { for (var f, r, e = [], u = document.getElementsByTagName(n), i = 0; i < u.length; i++) for (f = u[i].className.split(" "), r = 0; r < f.length; r++) f[r] == t && e.push(u[i]); return e } function o(n) { var r = null, t, i; if (n && n.match("epk-[0-9,A-F][A-Z][0-9,A-F]*")) { var u = n.substr(4).replace(/[-,G-Z]/g, ""), f = 0, e = u.length, o = e % 2; for (t = 0; t < e; t++) i = parseInt(u.charAt(t), 16), t % 2 == o && (i *= 2), i > 15 && (i -= 15), f += i; r = f % 16 == 0 } return r } function f() { var n = (new Date).getTime(); return window.performance && typeof window.performance.now == "function" && (n += performance.now()), "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) { var i = (n + Math.random() * 16) % 16 | 0; return n = Math.floor(n / 16), (t == "x" ? i : i & 3 | 8).toString(16) }) } function s() { var n = t("pageId"); return n || (n = f(), i("pageId", n)), n } function h(n, r) { t(n) || (window.addEventListener ? addEventListener("message", r, !1) : window.attachEvent("onmessage", r), i(n, !0)) } function r(n) { return n.replace(/[A-Z]/g, "-$&").toLowerCase() } function c(n) { var o = [], i, e = [], s = document.getElementById(n), u, t, f; if (s.currentStyle) { i = s.currentStyle; for (u in i) t = r(u), f = i[u], f && (t.match(/^font.family.*/i) || t.match(/^font.size.*/i) || t.match(/^font.style.*/i) || t.match(/^font.weight.*/i) || t.match(/^border.*radius.*/i) || t.match(/^padding.*/i) || t.match(/^margin.*/i)) && (e[t] || (o.push(t + ": " + f), e[t] = 1)) } else { i = window.getComputedStyle(s, null); for (u in i) t = r(i.item(u)), f = i.getPropertyValue(i[u]), f && (t.match(/^font.family.*/i) || t.match(/^font.size.*/i) || t.match(/^font.style.*/i) || t.match(/^font.weight.*/i) || t.match(/^border.*radius.*/i) || t.match(/^padding.*/i) || t.match(/^margin.*/i)) && (e[t] || (o.push(t + ": " + f), e[t] = 1)) } return o.join(";") } function l(n, t) { for (var u, r, o, s, h, c, e = {}, f = n.split(";"), i = 0; i < f.length; i++) r = f[i].indexOf(":"), r >= 0 && f[i].length > r + 1 && (o = f[i].substr(0, r).trim(), s = f[i].substr(r + 1).trim(), e[o] = s); for (u = t.split(";"), i = 0; i < u.length; i++) r = u[i].indexOf(":"), r >= 0 && u[i].length > r + 1 && (o = u[i].substr(0, r).trim(), s = u[i].substr(r + 1).trim(), e[o] = s); h = ""; for (c in e) h += (h == "" ? "" : "; ") + c + ": " + e[c]; return h } function a(n) { var t = document.getElementById(n), r = t.offsetHeight, i = getComputedStyle(t); return r + (parseInt(i.marginTop) + parseInt(i.marginBottom)) } n.getVar = t; n.setVar = i; n.findElementsByClass = e; n.checkKey = o; n.generateUUID = f; n.getPageID = s; n.addMessageListener = h; n.camelCaseToCssName = r; n.getSelectedStyles = c; n.mergeStyles = l; n.getElemFullHeight = a; n.Base64 = { _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (t) { var e = "", o, i, r, h, c, s, u, f = 0; for (t = n.Base64._utf8_encode(t) ; f < t.length;) o = t.charCodeAt(f++), i = t.charCodeAt(f++), r = t.charCodeAt(f++), h = o >> 2, c = (o & 3) << 4 | i >> 4, s = (i & 15) << 2 | r >> 6, u = r & 63, isNaN(i) ? s = u = 64 : isNaN(r) && (u = 64), e = e + this._keyStr.charAt(h) + this._keyStr.charAt(c) + this._keyStr.charAt(s) + this._keyStr.charAt(u); return e }, decode: function (t) { var i = "", o, s, h, c, f, u, e, r = 0; for (t = t.replace(/[^A-Za-z0-9\+\/\=]/g, "") ; r < t.length;) c = this._keyStr.indexOf(t.charAt(r++)), f = this._keyStr.indexOf(t.charAt(r++)), u = this._keyStr.indexOf(t.charAt(r++)), e = this._keyStr.indexOf(t.charAt(r++)), o = c << 2 | f >> 4, s = (f & 15) << 4 | u >> 2, h = (u & 3) << 6 | e, i = i + String.fromCharCode(o), u != 64 && (i = i + String.fromCharCode(s)), e != 64 && (i = i + String.fromCharCode(h)); return n.Base64._utf8_decode(i) }, _utf8_encode: function (n) { var i, r, t; for (n = n.replace(/\r\n/g, "\n"), i = "", r = 0; r < n.length; r++) t = n.charCodeAt(r), t < 128 ? i += String.fromCharCode(t) : t > 127 && t < 2048 ? (i += String.fromCharCode(t >> 6 | 192), i += String.fromCharCode(t & 63 | 128)) : (i += String.fromCharCode(t >> 12 | 224), i += String.fromCharCode(t >> 6 & 63 | 128), i += String.fromCharCode(t & 63 | 128)); return i }, _utf8_decode: function (n) { for (var r = "", t = 0, i = 0, u = 0, f = 0; t < n.length;) i = n.charCodeAt(t), i < 128 ? (r += String.fromCharCode(i), t++) : i > 191 && i < 224 ? (u = n.charCodeAt(t + 1), r += String.fromCharCode((i & 31) << 6 | u & 63), t += 2) : (u = n.charCodeAt(t + 1), f = n.charCodeAt(t + 2), r += String.fromCharCode((i & 15) << 12 | (u & 63) << 6 | f & 63), t += 3); return r } } }(eWAYUtils || (eWAYUtils = {})); fieldEvent = function () { function n(n) { var i, t; if (this.errors = null, this.targetField = null, this.originaldata = n.data, this.fieldValid = !1, this.valueIsValid = !1, this.valueIsSaved = !1, this.valueHasFocus = !1, n.data && (n.origin.match(/ewaypayments.com$/) || n.origin.match(/localhost:44300$/) || n.origin.match(/localhost:49874$/))) { for (i = n.data.split(","), t = 0; t < i.length; t++) i[t].match(/^tf:/i) && (this.targetField = i[t].replace(/^tf:/i, "").toLowerCase()), i[t].match(/^otc:/i) && (this.secureFieldCode = i[t].replace(/^otc:/i, "")), i[t].match(/^fv:/i) && i[t].replace(/^fv:/i, "") == "1" && (this.valueIsValid = !0), i[t].match(/^fs:/i) && i[t].replace(/^fs:/i, "") == "1" && (this.valueIsSaved = !0), i[t].match(/^ff:/i) && i[t].replace(/^ff:/i, "") == "1" && (this.valueHasFocus = !0), i[t].match(/^fe:/i) && (this.errors = i[t].replace(/^fe:/i, "")); this.targetField && this.secureFieldCode && !this.errors && (this.fieldValid = !0) } } return n }(); secureField = function () { function n(n, t) { var r, u, i, f; this.publicApiKey = null; this.fieldType = null; this.mask = null; this.div = null; this.id = null; this.iframe = null; this.stylesb64 = null; this.callbackFunc = t; this.needsSave = !1; r = []; this.publicApiKey = n.publicApiKey; eWAYUtils.checkKey(this.publicApiKey) || (this.publicApiKey = null, r.push("V6143")); this.fieldType = n.fieldType.toLowerCase(); this.fieldType == "card" || this.fieldType == "expiry" || this.fieldType == "cvn" || this.fieldType == "name" ? this.id = "eway-secure-" + this.fieldType + "-field" : (this.fieldType = null, r.push("V6210")); this.mask = n.maskValues; n.fieldDivId ? this.div = document.getElementById(n.fieldDivId) : n.fieldDivClass && (u = eWAYUtils.findElementsByClass("div", n.fieldDivClass), u.length == 1 && (this.div = u[0])); this.div || r.push("V6211"); i = ""; n.styleTemplateId && (i = eWAYUtils.getSelectedStyles(n.styleTemplateId), f = eWAYUtils.getElemFullHeight(n.styleTemplateId), f && (i += "; height: " + f + "px")); n.styles && (i = eWAYUtils.mergeStyles(i, n.styles)); i != "" && (this.stylesb64 = eWAYUtils.Base64.encode(i)); r.length > 0 && (this.errors = r.join(",")) } return n.prototype.styles = function () { return this.stylesb64 == null ? "" : eWAYUtils.Base64.decode(this.stylesb64) }, n.prototype.isValid = function () { var n = !0; return this.div || (n = !1), eWAYUtils.checkKey(this.publicApiKey) || (n = !1), this.fieldType == "card" || this.fieldType == "expiry" || this.fieldType == "cvn" || this.fieldType == "name" || (n = !1), n }, n.prototype.sharedUrl = function () { var t = eWAYUtils.getVar("endpoints"), n = null; return eWAYUtils.checkKey(this.publicApiKey) && (n = t[this.publicApiKey.charAt(5)]), n += "/SecureField?PublicAPIKey=" + this.publicApiKey + "&type=" + this.fieldType + "&pageid=" + eWAYUtils.getPageID(), this.stylesb64 && (n += "&style=" + encodeURIComponent(this.stylesb64)), this.mask != null && (n += "&mask=" + this.mask), n }, n.prototype.createIFrame = function () { return this.iframe = document.createElement("iframe"), this.iframe.id = this.id, this.iframe.setAttribute("allowTransparency", "true"), this.iframe.style.cssText = "z-index: 9999; display: block; border: 0px none transparent; margin: 0px; padding: 0px; -webkit-tap-highlight-color: transparent; width: 100%; height: 100%; background: transparent;", this.div.appendChild(this.iframe), this.iframe.src = this.sharedUrl(), this.iframe }, n.prototype.saveField = function () { this.needsSave == !0 && (this.iframe.contentWindow.postMessage("save", "*"), this.needsSave = !1) }, n.prototype.handleEvent = function (n) { var t = new fieldEvent(n); t.targetField == this.fieldType && this.callbackFunc && !t.valueHasFocus && (this.needsSave = !t.valueIsSaved, this.callbackFunc(t)); t.valueHasFocus && t.targetField != this.fieldType && this.saveField(); t.valueHasFocus && t.targetField == this.fieldType && (this.needsSave = !0) }, n }(), function (n) { function f(n, t) { var i = new secureField(n, t), f, u; return i.isValid() && (f = i.createIFrame(), f) ? (u = eWAYUtils.getVar("activeFields"), u.push(i), eWAYUtils.setVar("activeFields", u), eWAYUtils.addMessageListener("secureFields", r), n.disablePageClickHandler || h("clickHandler", s), !0) : (t && t({ fieldValid: !1, valueIsValid: !1, valueIsSaved: !1, errors: i.errors }), !1) } function e(n) { for (var i = eWAYUtils.getVar("activeFields"), t = 0; t < i.length; t++) if (i[t].fieldType == n) return i[t]; return null } function o(n, r) { for (var e = eWAYUtils.getVar("activeFields"), f = 0; f < e.length; f++) e[f].saveField(); n && r >= 0 && (t = r, i = n, setTimeout(u, 100)) } function r(n) { for (var i = eWAYUtils.getVar("activeFields"), t = 0; t < i.length; t++) i[t].callbackFunc && i[t].handleEvent(n) } function u() { for (var n = !1, f = eWAYUtils.getVar("activeFields"), r = 0; r < f.length; r++) n = n || f[r].needsSave; t = t - 100; !n || t <= 0 ? i() : setTimeout(u, 100) } function s() { for (var t = eWAYUtils.getVar("activeFields"), n = 0; n < t.length; n++) t[n].saveField() } function h(n, t) { eWAYUtils.getVar(n) || (document.body.addEventListener("click", t, !0), document.body.onfocusin && (document.body.onfocusin = t), eWAYUtils.setVar(n, !0)) } function c() { eWAYUtils.setVar("endpoints", { X: "http://localhost:49874", Y: "http://dev.secure.ewaypayments.com/sharedpage", T: "http://staging.secure.ewaypayments.com/sharedpage", U: "https://staging.secure-uk.ewaypayments.com/sharedpage", V: "http://api.sandbox.ewaypayments.com/staging-au/sharedpage", W: "https://api.sandbox.ewaypayments.com/staging-uk/sharedpage", A: "https://secure.ewaypayments.com/sharedpage", B: "https://secure-uk.ewaypayments.com/sharedpage", C: "https://secure-au.sandbox.ewaypayments.com/sharedpage", D: "https://secure-uk.sandbox.ewaypayments.com/sharedpage" }); eWAYUtils.setVar("defaultEndpoint", "A"); eWAYUtils.setVar("modalEndpoints", { production: "https://secure.ewaypayments.com/sharedpage", sandbox: "https://secure-au.sandbox.ewaypayments.com/sharedpage", "production-uk": "https://secure-uk.ewaypayments.com/sharedpage", "sandbox-uk": "https://secure-uk.sandbox.ewaypayments.com/sharedpage" }); eWAYUtils.setVar("activeFields", []) } n.setupSecureField = f; n.getField = e; var t = 0, i = null; n.saveAllFields = o; n.eventHandler = r; c(); eWAYUtils.getPageID() }(eWAY || (eWAY = {}));
//# sourceMappingURL=eWAY.min.js.map